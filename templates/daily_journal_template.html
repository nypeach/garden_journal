<!doctype html>
<html lang="en">
<!-- Template Version 13 -->

<head>
  <meta charset="utf-8">
  <title>Daily Journal: {{ date }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
</head>

<body class="has-fixed-header">
  <div class="fixed-header">
    <div class="fixed-header-content">
      <h1><span class='emoji'>üåø</span> Daily Journal</h1>
      <p class="note">Date: {{ formatted_date }} ‚Ä¢ Panels 1‚Äì18 (left ‚Üí right); Stakes 1‚Äì4 within raised bed. (<a
          href="../forms/index.html" onclick="window.close(); return false;">üåø Back to Home</a>)</p>
      <hr class="divider" />
    </div>
  </div>

  <main>
    <!-- SUMMARY OF ACTIVITIES -->
    <h2><span class='emoji'>üìã</span>Summary of Activities</h2>
    {% if activities and activities|length > 0 %}
    <ul>
      {% for activity in activities %}
      <li>{{ activity }}</li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="empty-state">No activities recorded for this date</p>
    {% endif %}

    <!-- WEATHER / SUN CONDITIONS -->
    <h2><span class='emoji'>‚òÄÔ∏è</span>Weather / Sun Conditions</h2>
    {% if weather %}
    <ul>
      {% if weather.temp_high and weather.temp_low %}
      <li><strong>Temperature:</strong> {{ weather.temp_low }}¬∞F ‚Äì {{ weather.temp_high }}¬∞F</li>
      {% endif %}
      {% if weather.conditions %}
      <li><strong>Conditions:</strong> {{ weather.conditions }}</li>
      {% endif %}
      {% if weather.sunrise and weather.sunset %}
      <li><strong>Sun:</strong> Sunrise {{ weather.sunrise }}, Sunset {{ weather.sunset }}</li>
      {% endif %}
      {% if weather.humidity %}
      <li><strong>Humidity:</strong> {{ weather.humidity }}%</li>
      {% endif %}
      {% if weather.wind %}
      <li><strong>Wind:</strong> {{ weather.wind }}</li>
      {% endif %}
      {% if weather.notes %}
      <li><strong>Notes:</strong> {{ weather.notes }}</li>
      {% endif %}
    </ul>
    {% else %}
    <p class="empty-state">No weather update recorded for this date</p>
    {% endif %}

    <!-- GENERAL OBSERVATIONS -->
    <h2><span class='emoji'>üëÄ</span>General Observations</h2>
    {% if observations and observations|length > 0 %}
    <ul>
      {% for observation in observations %}
      <li>{{ observation }}</li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="empty-state">No general observations recorded</p>
    {% endif %}

    <!-- QUESTIONS & ANSWERS (GENERAL) -->
    <h2><span class='emoji'>‚ùì</span>Questions &amp; Answers</h2>
    {% if questions_and_answers and questions_and_answers|length > 0 %}
    {% for qa in questions_and_answers %}
    <div class="qa-item">
      <div class="qa-question">Q: {{ qa.question }}</div>
      <div class="qa-answer">A: {{ qa.answer }}</div>
    </div>
    {% endfor %}
    {% else %}
    <p class="empty-state">No questions &amp; answers today</p>
    {% endif %}

    <!-- UPCOMING ACTIONS -->
    <h2><span class='emoji'>üìã</span>Upcoming Actions</h2>
    {% if upcoming_actions and upcoming_actions|length > 0 %}
    <ul>
      {% for action in upcoming_actions %}
      <li>
        <strong>{{ action.description }}</strong>
        {% if action.target_timeframe %} ({{ action.target_timeframe }}){% endif %}
        {% if action.plants_affected and action.plants_affected|length > 0 %}
        <span class="subtle">: Affects: {{ action.plants_affected|join(', ') }}</span>
        {% endif %}
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="empty-state">No upcoming actions planned</p>
    {% endif %}

    <hr class="divider" />

    <!-- PLANT BY PLANT -->
    <h2 class="major-section"><span class='emoji'>ü™¥</span>Plant by Plant</h2>
    <p class="note">Each entry lists container, care notes, and photos with observations made throughout the day</p>

    {# This template expects plant_observations_grouped dict from generator #}
    {# Format: {"Panel 1 - Basil Pot - Left": [obs1], "Panel 7 - Pepper Box": [obs1, obs2, obs3]} #}

    {% for container_key, obs_list in plant_observations_grouped.items() %}

    {# Check if multiple plants share this container with stakes #}
    {% if obs_list|length > 1 and obs_list[0].stake %}

    {# Staked container header #}
    <h3>{{ container_key }}</h3>

    {% for obs in obs_list %}
    <div class="stake">
      <div class="stake-title">
        Stake {{ obs.stake }}: {{ obs.plant_id|replace('_', ' ')|title }}
        {% if obs.time %}<span class="time-badge">{{ obs.time }}</span>{% endif %}
      </div>
      <ul>
        <li><strong>Soil Mix:</strong> {{ obs.soil_mix }}</li>
        {% if obs.soil_moisture %}
        <li><strong>Soil Moisture:</strong> {{ obs.soil_moisture }}</li>
        {% endif %}
        <li><strong>Current Stage:</strong> {{ obs.current_stage }}</li>
        <li><strong>Next Stage:</strong> {{ obs.next_stage }}</li>
        <li><strong>Observations:</strong> {{ obs.observations }}</li>
        {% if obs.actions_taken and obs.actions_taken|length > 0 %}
        <li><strong>Actions Taken:</strong>
          <ul style="margin-top: 4px;">
            {% for action in obs.actions_taken %}
            <li style="margin-left: 20px;">{{ action }}</li>
            {% endfor %}
          </ul>
        </li>
        {% endif %}
        {% if obs.notes %}
        <li><strong>Notes:</strong> {{ obs.notes }}</li>
        {% endif %}
      </ul>

      {% if obs.plant_qa %}
      <div class="qa-section-header"><span class='emoji'>‚ùì</span>Questions &amp; Answers</div>
      <div class="qa-item">
        <div class="qa-question">Q: {{ obs.plant_qa.question }}</div>
        <div class="qa-answer">A: {{ obs.plant_qa.answer }}</div>
      </div>
      {% endif %}

      {% if obs.photos and obs.photos|length > 0 %}
      <div class="photo-row">
        {% for photo in obs.photos[:4] %}
        <div class="photo-container">
          <img src="../photos/{{ photo.filename }}" alt="{{ obs.plant_id }}" class="photo">
          {% if photo.caption %}
          <div class="photo-caption">{{ photo.caption }}</div>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </div>
    {% endfor %}

    <hr class="divider" />

    {% else %}
    {# Regular panel or shared container without stakes #}

    {% if obs_list|length > 1 %}
    {# Shared container header (no stakes) #}
    <h3>{{ container_key }}</h3>
    {% endif %}

    {% for obs in obs_list %}
    <div class="panel" {% if obs_list|length> 1 %}style="margin-left: 20px;"{% endif %}>
      <div class="panel-title">
        {% if obs_list|length == 1 %}
        {{ container_key }}
        {% else %}
        {{ obs.plant_id|replace('_', ' ')|title }}
        {% endif %}
        {% if obs.time %}<span class="time-badge">{{ obs.time }}</span>{% endif %}
      </div>
      <ul>
        <li><strong>Container:</strong> {{ obs.container_type }}</li>
        {% if obs.position %}
        <li><strong>Position:</strong> {{ obs.position }}</li>
        {% endif %}
        <li><strong>Soil Mix:</strong> {{ obs.soil_mix }}</li>
        {% if obs.soil_moisture %}
        <li><strong>Soil Moisture:</strong> {{ obs.soil_moisture }}</li>
        {% endif %}
        <li><strong>Current Stage:</strong> {{ obs.current_stage }}</li>
        <li><strong>Next Stage:</strong> {{ obs.next_stage }}</li>
        <li><strong>Observations:</strong> {{ obs.observations }}</li>
        {% if obs.actions_taken and obs.actions_taken|length > 0 %}
        <li><strong>Actions Taken:</strong>
          <ul style="margin-top: 4px;">
            {% for action in obs.actions_taken %}
            <li style="margin-left: 20px;">{{ action }}</li>
            {% endfor %}
          </ul>
        </li>
        {% endif %}
        {% if obs.notes %}
        <li><strong>Notes:</strong> {{ obs.notes }}</li>
        {% endif %}
      </ul>

      {% if obs.plant_qa %}
      <div class="qa-section-header"><span class='emoji'>‚ùì</span>Questions &amp; Answers</div>
      <div class="qa-item">
        <div class="qa-question">Q: {{ obs.plant_qa.question }}</div>
        <div class="qa-answer">A: {{ obs.plant_qa.answer }}</div>
      </div>
      {% endif %}

      {% if obs.photos and obs.photos|length > 0 %}
      <div class="photo-row">
        {% for photo in obs.photos[:4] %}
        <div class="photo-container">
          <img src="../photos/{{ photo.filename }}" alt="{{ obs.plant_id }}" class="photo">
          {% if photo.caption %}
          <div class="photo-caption">{{ photo.caption }}</div>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </div>
    {% endfor %}

    <hr class="divider" />
    {% endif %}

    {% endfor %}

  </main>
</body>

</html>